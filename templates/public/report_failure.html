{% extends "base.html" %}

{% block content %}
<div class="container my-4" style="max-width: 800px;">
    <div class="text-center mb-4">
        <i class="bi bi-tools text-primary" style="font-size: 3rem;"></i>
        <h1 class="h3 mt-2">Submit a Failure Report</h1>
        <p class="text-muted">You are reporting an issue for: <strong>{{ equipment.name }}</strong> (ID: {{ equipment.equipment_id }})</p>
    </div>

    {% include 'partials/_flash_messages.html' %}

    <div class="card">
        <div class="card-body p-lg-4">
            <form id="failureReportForm" method="POST" action="{{ url_for('report_failure', equip_id=equipment.id) }}" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="title" class="form-label">Issue Title <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="title" name="title" placeholder="e.g., Leaking hydraulic fluid, Loud grinding noise" required>
                </div>
                <div class="mb-3">
                    <label for="priority" class="form-label">Priority</label>
                    <select class="form-select" id="priority" name="priority">
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Urgent" selected>Urgent</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
                    <textarea class="form-control" id="description" name="description" rows="5" placeholder="Please describe the issue in detail. What happened? What sounds did it make? Where is the problem located on the machine?" required></textarea>
                </div>
                
                <hr>
                
                <h5 class="mt-4">Your Information (Optional)</h5>
                <p class="text-muted small">Provide your name and email if you would like to receive status updates on your report.</p>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="guest_name" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="guest_name" name="guest_name">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="guest_email" class="form-label">Your Email</label>
                        <input type="email" class="form-control" id="guest_email" name="guest_email">
                    </div>
                </div>
                
                <hr>
                
                <h5 class="mt-4">Add Media</h5>
                <p class="text-muted small">Attaching photos or videos of the issue is highly recommended.</p>
                <div class="mb-3">
                    <label for="images" class="form-label">Images</label>
                    <div class="input-group">
                        <input class="form-control" type="file" id="images" name="images" multiple accept="image/*">
                        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#captureModal" data-capture-type="image"><i class="bi bi-camera-fill me-1"></i> Capture</button>
                    </div>
                    <div class="row gx-2 gy-2 mt-2" id="images-preview"></div>
                </div>
                <div class="mb-3">
                    <label for="videos" class="form-label">Videos</label>
                    <div class="input-group">
                        <input class="form-control" type="file" id="videos" name="videos" multiple accept="video/*">
                        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#captureModal" data-capture-type="video"><i class="bi bi-camera-reels-fill me-1"></i> Record</button>
                    </div>
                    <div class="row gx-2 gy-2 mt-2" id="videos-preview"></div>
                </div>
                <div class="mb-3">
                    <label for="audio_files" class="form-label">Audio Notes</label>
                     <div class="input-group">
                        <input class="form-control" type="file" id="audio_files" name="audio_files" multiple accept="audio/*">
                        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#captureModal" data-capture-type="audio"><i class="bi bi-mic-fill me-1"></i> Record</button>
                    </div>
                    <div class="row gx-2 gy-2 mt-2" id="audio_files-preview"></div>
                </div>
                <div class="mb-3">
                    <label for="documents" class="form-label">Documents</label>
                    <input class="form-control" type="file" id="documents" name="documents" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt">
                    <div class="row gx-2 gy-2 mt-2" id="documents-preview"></div>
                </div>
                
                <hr>
                <div class="text-end mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">Submit Report</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- This modal needs to be included for the capture buttons to work -->
{% include 'partials/_capture_modal.html' %}
{% endblock %}

{% block scripts %}
    <!-- This generic script file contains all the logic for the file previews and capture modal -->
    {% include 'partials/_form_scripts.html' %}
{% endblock %}