{% extends "base.html" %}

{% block content %}
<div class="container my-4" style="max-width: 800px;">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4 mb-print-2">
        <div>
            <h1 class="h3 mb-0">
                <i class="bi bi-qr-code text-primary me-2"></i>
                QR Code for {{ equipment.name }}
            </h1>
            <p class="text-muted">For quick failure reporting by anyone.</p>
        </div>
    </div>

    <!-- Main Card -->
    <div class="card shadow-sm">
        <div class="card-body p-lg-5">
            <!-- QR Code Display -->
            <div class="text-center border p-4 rounded-3 mb-4 qr-code-bg">
                <h5 class="mb-2">Submit Work Request</h5>
                <img src="{{ qr_img }}" alt="QR Code" class="img-fluid qr-code-img" style="max-width: 250px; padding: 10px; border-radius: 10px;">
                <h4 class="mt-3 mb-1">{{ equipment.name }}</h4>
                <!-- "Scan with any smartphone" text removed -->
            </div>
            
            <!-- URL Display (Moved and Centered) -->
            <div class="text-center mb-4 mb-print-3">
                <p class="text-muted small mb-1"><strong>URL:</strong></p>
                <code id="qrUrlText">{{ qr_url }}</code>
            </div>

            <!-- Equipment Information -->
            <div class="mb-4 mb-print-3">
                <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i>Equipment Details</h5>
                <div class="row">
                    <div class="col-md-6"><p class="mb-2"><strong>ID:</strong> <code>{{ equipment.equipment_id }}</code></p></div>
                    <div class="col-md-6"><p class="mb-2"><strong>Category:</strong> {{ equipment.category.name if equipment.category else 'N/A' }}</p></div>
                    <div class="col-md-6"><p class="mb-2"><strong>Location:</strong> {{ equipment.location.name if equipment.location else 'N/A' }}</p></div>
                </div>
            </div>

            <!-- Download & Action Buttons -->
            <div class="text-center mb-4">              
                <h5 class="mb-3 d-print-none"><i class="bi bi-download me-2"></i>Actions</h5>
                <a href="{{ url_for('view_equipment', equip_id=equipment.id) }}" class="btn btn-secondary me-2"><i class="bi bi-arrow-left me-1"></i> Back</a>
                <a href="{{ qr_img }}" download="qr-code-{{ equipment.equipment_id }}.png" class="btn btn-primary me-2"><i class="bi bi-download me-1"></i> Download PNG</a>
                <button class="btn btn-secondary me-2" id="copyUrlBtn"><i class="bi bi-clipboard me-1"></i> Copy URL</button>
                <button class="btn btn-secondary" onclick="window.print()"><i class="bi bi-printer me-1"></i> Print</button>
            </div>

            <!-- How to Use -->
            <div>
                <h5 class="mb-3"><i class="bi bi-question-circle me-2"></i>How to Use This QR Code</h5>
                <ol>
                    <li><strong>Print & Attach:</strong> Print this page and attach the QR code securely to the equipment.</li>
                    <li><strong>Scan:</strong> Anyone with a smartphone can scan the code to open the failure report form.</li>
                    <li><strong>Submit:</strong> The submitted report will automatically create a work order request for approval.</li>
                </ol>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const copyBtn = document.getElementById('copyUrlBtn');
    if (copyBtn) {
        copyBtn.addEventListener('click', function() {
            const urlText = document.getElementById('qrUrlText').innerText;
            navigator.clipboard.writeText(urlText).then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="bi bi-check-lg"></i> Copied!';
                setTimeout(() => { this.innerHTML = originalText; }, 2000);
            }).catch(err => console.error('Failed to copy URL: ', err));
        });
    }
});
</script>
{% endblock %}